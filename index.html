<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>অপৰাজিতা কম্পিউটাৰচ - Digital & Print Services</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
    <style>
        body { font-family: "Poppins", sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #0891b2; border-radius: 10px; }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-down { animation: fadeInDown 1s ease-out forwards; }
        .star-rating input { display: none; }
        .star-rating label { font-size: 2rem; color: #4b5563; cursor: pointer; transition: color 0.2s; }
        .star-rating input:checked ~ label, .star-rating label:hover, .star-rating label:hover ~ label { color: #f59e0b; }
        .modal-fade-enter { transition: opacity 0.3s ease-out, transform 0.3s ease-out; }
        .modal-fade-enter-from { opacity: 0; transform: scale(0.95); }
        .modal-fade-enter-to { opacity: 1; transform: scale(1); }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- =========== START: MAINTENANCE POPUP =========== -->
    <div id="maintenance-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-[60] hidden modal-fade-enter modal-fade-enter-from">
        <div class="bg-gray-800 border border-red-500/30 w-full max-w-lg p-6 sm:p-8 rounded-2xl shadow-2xl space-y-4 text-center">
            <div class="flex justify-center">
                 <svg class="w-16 h-16 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
            </div>
            <h2 class="text-2xl font-bold text-red-400">Important Service & Payment Notice</h2>
            <p class="text-gray-300">Our website is currently undergoing essential maintenance. During this period, all services and payment gateways are temporarily disabled.</p>
            <div class="font-semibold text-red-300 bg-red-900/40 border border-red-500/50 p-3 rounded-md text-sm">
                <p class="font-bold text-lg">CRITICAL WARNING</p>
                <p>Please do not attempt to place any orders or make payments. Any transaction made during this period will fail, cannot be refunded, and we are not responsible for any financial loss. No services can be claimed.</p>
            </div>
            <p class="text-gray-400 text-sm">We apologize for the inconvenience and thank you for your understanding.</p>
            <button id="close-modal-btn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-6 rounded-md transition-colors mt-4">I Acknowledge and Understand</button>
        </div>
    </div>
    <!-- =========== END: MAINTENANCE POPUP =========== -->

    <header class="bg-gray-800/80 backdrop-blur-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
            <a href="index.html" class="text-2xl font-bold text-cyan-400">অপৰাজিতা কম্পিউটাৰচ</a>
            <div class="hidden md:flex space-x-6 items-center" id="desktop-nav-links">
                <!-- Desktop links will be populated by JS -->
            </div>
            <div class="md:hidden">
                <button id="menu-btn" class="text-white focus:outline-none z-[51] relative">
                    <!-- Hamburger/Close Icon -->
                    <svg id="menu-open-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    <svg id="menu-close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        </nav>
    </header>
    
    <!-- Mobile Menu -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden"></div>
    <div id="mobile-menu" class="fixed top-0 right-0 h-full w-64 bg-gray-800 shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out md:hidden p-8 pt-20 space-y-4 z-40">
        <!-- Mobile links will be populated by JS -->
    </div>

    <main>
        <!-- HERO SECTION -->
        <section id="home" class="relative h-[calc(100vh-4rem)] bg-gray-800">
             <div class="absolute inset-0 bg-black/60"></div>
            <div class="relative h-full flex items-center justify-center text-center z-10 px-4">
                <div>
                    <h1 class="text-4xl md:text-6xl font-bold mb-4 fade-in-down">Your One-Stop Digital & Print Shop</h1>
                    <p class="text-lg md:text-xl text-gray-300 mb-8 max-w-2xl mx-auto fade-in-down" style="animation-delay: 0.3s;">From online form submissions to high-quality photo printing, we handle all your needs with speed and care.</p>
                    <a href="login.html" id="hero-cta-btn" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-transform hover:scale-105 duration-300 fade-in-down" style="animation-delay: 0.6s;">Login to View Services</a>
                </div>
            </div>
        </section>

        <!-- SERVICES SECTION (Hidden by default) -->
        <section id="services" class="py-20 bg-gray-900 hidden">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-2">Our Services</h2>
                <p class="text-gray-400 mb-8 max-w-xl mx-auto">Select a service to get started. All prices are indicative and may vary.</p>
                <div class="mb-12 max-w-lg mx-auto">
                    <input type="text" id="service-search" placeholder="Search for a service (e.g., 'photo', 'form')..." class="w-full p-3 bg-gray-700 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                </div>
                <div id="service-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                <p id="no-services-found" class="text-gray-500 mt-8 hidden">No services match your search.</p>
            </div>
        </section>

        <!-- PRICING SECTION -->
        <section id="pricing" class="py-20 bg-gray-800">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-2">Simple & Transparent Pricing</h2>
                <p class="text-gray-400 mb-12 max-w-xl mx-auto">No hidden fees. Get the best rates for top-quality services.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="border border-gray-700 rounded-lg p-6"><h3 class="text-lg font-semibold text-cyan-400">Xerox</h3><p class="text-4xl font-bold my-2">₹3</p><p class="text-gray-400">per page (A4)</p></div>
                    <div class="border border-gray-700 rounded-lg p-6"><h3 class="text-lg font-semibold text-cyan-400">Xerox (Both Side) / ID</h3><p class="text-4xl font-bold my-2">₹4</p><p class="text-gray-400">per page (A4)</p></div>
                    <div class="border border-gray-700 rounded-lg p-6"><h3 class="text-lg font-semibold text-cyan-400">Xerox (Legal)</h3><p class="text-4xl font-bold my-2">₹4</p><p class="text-gray-400">per page</p></div>
                    <div class="border border-gray-700 rounded-lg p-6"><h3 class="text-lg font-semibold text-cyan-400">B&W Print</h3><p class="text-4xl font-bold my-2">₹5</p><p class="text-gray-400">per page (A4)</p></div>
                    <div class="border border-gray-700 rounded-lg p-6"><h3 class="text-lg font-semibold text-cyan-400">Color Print</h3><p class="text-4xl font-bold my-2">₹15</p><p class="text-gray-400">per page (A4)</p></div>
                    <div class="border border-gray-700 rounded-lg p-6"><h3 class="text-lg font-semibold text-cyan-400">Lamination</h3><p class="text-4xl font-bold my-2">₹25</p><p class="text-gray-400">per page (A4)</p></div>
                    <div class="border border-gray-700 rounded-lg p-6"><h3 class="text-lg font-semibold text-cyan-400">DTP</h3><p class="text-2xl font-bold my-2">₹40 (Eng) / ₹50 (Ass)</p><p class="text-gray-400">per page (A4)</p></div>
                    <div class="border border-gray-700 rounded-lg p-6"><h3 class="text-lg font-semibold text-cyan-400">Spiral Binding</h3><p class="text-4xl font-bold my-2">₹150</p><p class="text-gray-400">starts from</p></div>
                </div>
                <p class="text-gray-400 mt-8">For form filling and other services, please contact us for a quote.</p>
                <div class="mt-12">
                    <h3 class="text-lg font-semibold text-gray-300 mb-4">We Accept</h3>
                    <div class="flex justify-center items-center space-x-4">
                        <img src="https://placehold.co/80x40/ffffff/000000?text=UPI" alt="UPI" class="h-8 bg-white rounded p-1">
                        <img src="https://placehold.co/80x40/ffffff/000000?text=Visa" alt="Visa" class="h-8 bg-white rounded p-1">
                        <img src="https://placehold.co/80x40/ffffff/000000?text=Mastercard" alt="Mastercard" class="h-8 bg-white rounded p-1">
                        <img src="https://placehold.co/80x40/ffffff/000000?text=GPay" alt="Google Pay" class="h-8 bg-white rounded p-1">
                    </div>
                </div>
            </div>
        </section>

        <!-- UPLOAD SECTION (Hidden by default) -->
        <section id="upload" class="py-20 bg-gray-900 hidden">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="bg-gray-800 rounded-lg shadow-xl p-8 md:p-12">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold mb-4">Ready to Print or Submit a Form?</h2>
                        <p class="text-gray-400 mb-6">Upload your files securely, provide instructions, and we'll get back to you with a confirmation.</p>
                    </div>
                    <form id="uploadForm" class="max-w-xl mx-auto space-y-4">
                        <input type="text" name="customerName" id="upload-customer-name" placeholder="Your Name" required class="w-full p-3 bg-gray-700 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500" />
                        <input type="email" name="customerEmail" id="upload-customer-email" placeholder="Your Email" required class="w-full p-3 bg-gray-700 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500" />
                        <input type="file" name="file" required class="w-full text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-cyan-600 file:text-white hover:file:bg-cyan-700" />
                        <textarea name="instructions" placeholder="Instructions (e.g., '10 color prints, spiral bind')" rows="4" class="w-full p-3 bg-gray-700 rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500"></textarea>
                        <button type="submit" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-6 rounded-md transition-colors">Submit Request</button>
                    </form>
                    <div id="responseMessage" class="mt-4 text-center text-lg"></div>
                </div>
            </div>
        </section>

        <!-- CUSTOMER REVIEWS SECTION -->
        <section id="reviews" class="py-20 bg-gray-900">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-12">What Our Customers Say</h2>
                <div id="reviews-container" class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto"></div>
                <div id="review-form-container" class="hidden max-w-xl mx-auto mt-16 text-left"></div>
            </div>
        </section>

        <!-- LOCATION SECTION -->
        <section id="location" class="py-20 bg-gray-800">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-12">Find Us Here</h2>
                <div class="bg-gray-700 rounded-lg shadow-xl overflow-hidden">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3574.805566395351!2d92.0949646742045!3d26.36531998495147!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x375a59a9a9a9a9a9%3A0x3b3b3b3b3b3b3b3b!2sBalipota%2C%20Darrang%2C%20Assam!5e0!3m2!1sen!2sin!4v1678886400000" 
                        width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </section>
        
    </main>

    <footer id="contact" class="bg-gray-800 border-t border-gray-700">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-gray-400">
            <h3 class="text-2xl font-bold mb-4">Or Contact Us Directly</h3>
            <p class="mb-2">📍 Aparajiita Computers, Balipota, Darrang, Assam , 784525</p>
            <p class="mb-2">📞<a href="tel:+918638811645" class="hover:text-cyan-400">+91 8638811645</a></p>
            <p class="mb-2">📧<a href="mailto:aparajita.contact@gmail.com" class="hover:text-cyan-400">aparajita.contact@gmail.com</a></p>
            <p>🕒 24*7 : 9:00 AM - 8:00 PM</p>
            <p class="text-sm mt-6">&copy; 2025 Aparajita Computers. All Rights Reserved.</p>
            <p class="text-sm mt-1">Designed with ❤️ in Darrang (Assam).</p>
            <p class="text-sm mt-1">Designed by Aswini.</p>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        const modal = document.getElementById('maintenance-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const closeModal = () => {
            if (modal) {
                modal.classList.remove('modal-fade-enter-to');
                modal.classList.add('modal-fade-enter-from');
                setTimeout(() => { modal.classList.add('hidden'); }, 300);
            }
        };
        if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        if (modal) modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

        const baseUrl = '.'; 
        const escapeHTML = str => str ? str.replace(/[&<>"']/g, tag => ({'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'}[tag])) : '';

        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
        const menuOpenIcon = document.getElementById('menu-open-icon');
        const menuCloseIcon = document.getElementById('menu-close-icon');

        const toggleMenu = () => {
            if (!mobileMenu) return;
            const isOpen = mobileMenu.classList.contains('translate-x-0');
            mobileMenu.classList.toggle('translate-x-full', isOpen);
            mobileMenu.classList.toggle('translate-x-0', !isOpen);
            if (mobileMenuOverlay) mobileMenuOverlay.classList.toggle('hidden', isOpen);
            if (menuOpenIcon) menuOpenIcon.classList.toggle('hidden', !isOpen);
            if (menuCloseIcon) menuCloseIcon.classList.toggle('hidden', isOpen);
        };
        if (menuBtn) menuBtn.addEventListener('click', toggleMenu);
        if (mobileMenuOverlay) mobileMenuOverlay.addEventListener('click', toggleMenu);

        const services = [
            { id: 1, name: 'Online Form Submission', description: 'Job applications, government schemes, exams, and more.', price: 100, icon: '<svg class="w-12 h-12 mx-auto mb-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>' },
            { id: 2, name: 'Printing & Xerox', description: 'High-quality B&W and color printing. Fast and affordable.', price: 5, icon: '<svg class="w-12 h-12 mx-auto mb-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>' },
            { id: 3, name: 'Photo Printing', description: 'Passport photos, 4x6 prints, and custom sizes.', price: 20, icon: '<svg class="w-12 h-12 mx-auto mb-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>' },
            { id: 4, name: 'Document Binding', description: 'Spiral, comb, and thermal binding for reports and projects.', price: 150, icon: '<svg class="w-12 h-12 mx-auto mb-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v12a2 2 0 01-2 2h-2a2 2 0 01-2-2V6z"></path></svg>'},
            { id: 5, name: 'Lamination Service', description: 'Protect your important documents with high-quality lamination.', price: 25, icon: '<svg class="w-12 h-12 mx-auto mb-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V7a2 2 0 012-2h10a2 2 0 012 2v10a2 2 0 01-2 2z"></path></svg>'}
        ];

        const serviceCardsContainer = document.getElementById('service-cards-container');
        const searchInput = document.getElementById('service-search');
        const noServicesFound = document.getElementById('no-services-found');

        const renderServices = (filteredServices) => {
            if (!serviceCardsContainer) return;
            serviceCardsContainer.innerHTML = '';
            // Show "No services found" only when filteredServices is empty
            if (noServicesFound) noServicesFound.classList.toggle('hidden', filteredServices.length !== 0);
            filteredServices.forEach(service => {
                const card = document.createElement('div');
                card.className = 'service-card bg-gray-800 p-8 rounded-lg shadow-lg transform hover:-translate-y-2 transition-transform duration-300 flex flex-col justify-between';
                card.dataset.name = service.name;
                card.dataset.description = service.description;
                card.dataset.price = service.price;
                card.innerHTML = `
                    <div>
                        ${service.icon}
                        <h3 class="text-xl font-bold mb-2">${service.name}</h3>
                        <p class="text-gray-400">${service.description}</p>
                    </div>
                    <div class="mt-6">
                        <div class="flex items-center justify-center space-x-4 mb-4">
                            <button class="quantity-btn minus-btn bg-gray-700 hover:bg-gray-600 w-8 h-8 rounded-full font-bold text-lg" aria-label="Decrease quantity">-</button>
                            <span class="quantity-value text-xl font-bold">1</span>
                            <button class="quantity-btn plus-btn bg-gray-700 hover:bg-gray-600 w-8 h-8 rounded-full font-bold text-lg" aria-label="Increase quantity">+</button>
                        </div>
                        <button class="order-btn bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-md transition-colors w-full block">
                            Order Now (₹${service.price})
                        </button>
                    </div>`;
                serviceCardsContainer.appendChild(card);
            });
        };
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = services.filter(s => s.name.toLowerCase().includes(searchTerm) || s.description.toLowerCase().includes(searchTerm));
                renderServices(filtered);
            });
        }
        
        const postToGo = (url, params) => {
            const form = document.createElement('form');
            form.method = 'post';
            form.action = url;
            form.style.display = 'none';
            for (const key in params) {
                if (params.hasOwnProperty(key)) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = params[key];
                    form.appendChild(input);
                }
            }
            document.body.appendChild(form);
            form.submit();
        };

        let isUserLoggedIn = false;
        if (serviceCardsContainer) {
            serviceCardsContainer.addEventListener('click', (e) => {
                const target = e.target;
                const card = target.closest('.service-card');
                if (!card) return;
                if (target.matches('.quantity-btn')) {
                    const quantitySpan = card.querySelector('.quantity-value');
                    const orderBtn = card.querySelector('.order-btn');
                    const basePrice = parseFloat(card.dataset.price);
                    let quantity = parseInt(quantitySpan.textContent);
                    if (target.matches('.plus-btn')) quantity++;
                    else if (target.matches('.minus-btn') && quantity > 1) quantity--;
                    quantitySpan.textContent = quantity;
                    if (orderBtn) orderBtn.textContent = `Order Now (₹${basePrice * quantity})`;
                }
                if (target.matches('.order-btn')) {
                    if (isUserLoggedIn) {
                        const serviceName = card.dataset.name;
                        const unitPrice = parseFloat(card.dataset.price);
                        const quantity = parseInt(card.querySelector('.quantity-value').textContent);
                        postToGo('place_order.php', {
                            service_name: serviceName,
                            unit_price: unitPrice,
                            quantity: quantity
                        });
                    } else {
                        window.location.href = `login.html?error=${encodeURIComponent('You must log in to place an order.')}`;
                    }
                }
            });
        }
        
        const reviewsContainer = document.getElementById('reviews-container');
        const reviewFormContainer = document.getElementById('review-form-container');

        const fetchReviews = async () => {
            try {
                const response = await fetch(`fetch_reviews.php`);
                const data = await response.json();
                if (reviewsContainer) reviewsContainer.innerHTML = '';
                if (data.reviews && data.reviews.length > 0) {
                    data.reviews.forEach(review => {
                        const reviewCard = document.createElement('div');
                        reviewCard.className = 'bg-gray-700 p-6 rounded-lg text-left';
                        reviewCard.innerHTML = `
                            <div class="flex items-center mb-2 text-amber-400">${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</div>
                            <p class="text-gray-300 italic">"${escapeHTML(review.review_text)}"</p>
                            <p class="text-cyan-400 font-bold mt-4">- ${escapeHTML(review.username)}</p>`;
                        if (reviewsContainer) reviewsContainer.appendChild(reviewCard);
                    });
                } else {
                    if (reviewsContainer) reviewsContainer.innerHTML = '<p class="text-gray-500 col-span-full">Be the first to leave a review!</p>';
                }
            } catch (error) {
                console.error("Could not load reviews:", error);
                if (reviewsContainer) reviewsContainer.innerHTML = `<p class="text-red-400 col-span-full">Error loading reviews.</p>`;
            }
        };

        const handleReviewSubmit = async (e) => {
            e.preventDefault();
            const form = e.target;
            const msgDiv = form.querySelector('#reviewResponseMessage');
            const formData = new FormData(form);
            if (msgDiv) msgDiv.textContent = 'Submitting...';
            try {
                const response = await fetch(`submit_review.php`, { method: 'POST', body: formData });
                const data = await response.json();
                if(data.error) {
                    if (msgDiv) { msgDiv.className = 'text-red-400 text-center'; msgDiv.textContent = data.error; }
                } else {
                    if (msgDiv) { msgDiv.className = 'text-green-400 text-center'; msgDiv.textContent = data.success; }
                    form.reset();
                    setTimeout(() => {
                        if (reviewFormContainer) reviewFormContainer.innerHTML = `<div class="text-center p-8 bg-gray-700 rounded-lg"><p class="text-lg text-green-400">Thank you! Your review is pending approval.</p></div>`;
                        fetchReviews();
                    }, 2000);
                }
            } catch (error) {
                console.error("Error submitting review:", error);
                if (msgDiv) msgDiv.textContent = "An unexpected error occurred.";
            }
        };

        const updateUIForSession = async (session) => {
            const desktopNav = document.getElementById('desktop-nav-links');
            const heroCtaBtn = document.getElementById('hero-cta-btn');
            const sections = {
                services: document.getElementById('services'),
                upload: document.getElementById('upload'),
                reviewForm: document.getElementById('review-form-container'),
            };
            const uploadFields = {
                name: document.getElementById('upload-customer-name'),
                email: document.getElementById('upload-customer-email'),
            };

            let desktopLinksHTML = `
                <a href="#home" class="hover:text-cyan-400 transition-colors">Home</a>
                <a href="#pricing" class="hover:text-cyan-400 transition-colors">Pricing</a>
                <a href="#reviews" class="hover:text-cyan-400 transition-colors">Reviews</a>
                <a href="#location" class="hover:text-cyan-400 transition-colors">Location</a>
                <a href="#contact" class="hover:text-cyan-400 transition-colors">Contact</a>`;
            let mobileLinksHTML = desktopLinksHTML;

            if (session.loggedin) {
                isUserLoggedIn = true; 
                const commonLoggedInLinks = `
                    <a href="#services" class="hover:text-cyan-400 transition-colors">Services</a>
                    <a href="my_files.php" class="hover:text-cyan-400 transition-colors">My Files</a>
                    <a href="#upload" class="hover:text-cyan-400 transition-colors">Upload</a>
                    <a href="track_order.html" class="hover:text-cyan-400 transition-colors">Track Order</a>`;
                
                desktopLinksHTML += commonLoggedInLinks;
                mobileLinksHTML += commonLoggedInLinks;

                if (session.role === 'admin') {
                    desktopLinksHTML += `<a href="admin_dashboard.php" class="hover:text-yellow-400 transition-colors font-bold">Admin Panel</a>`;
                    mobileLinksHTML += `<a href="admin_dashboard.php" class="hover:text-yellow-400 transition-colors font-bold">Admin Panel</a>`;
                } else {
                    const modal = document.getElementById('maintenance-modal');
                    if (modal) {
                        modal.classList.remove('hidden');
                        setTimeout(() => {
                            modal.classList.remove('modal-fade-enter-from');
                            modal.classList.add('modal-fade-enter-to');
                        }, 10);
                    }
                }

                desktopLinksHTML += `
                    <div class="flex space-x-4 items-center">
                        <span class="text-gray-300">Welcome, ${escapeHTML(session.username)}!</span>
                        <a href="logout.php" class="hover:text-cyan-400 transition-colors">Logout</a>
                    </div>`;
                mobileLinksHTML += `<a href="logout.php" class="hover:text-cyan-400 transition-colors">Logout</a>`;
                
                if (heroCtaBtn) { heroCtaBtn.textContent = 'Browse Services'; heroCtaBtn.href = '#services'; }
                if (sections.services) sections.services.classList.remove('hidden');
                if (sections.upload) sections.upload.classList.remove('hidden');
                if(uploadFields.name) uploadFields.name.value = session.username;
                if(uploadFields.email) uploadFields.email.value = session.email;

                try {
                    const reviewResponse = await fetch(`check_review_status.php`);
                    const reviewStatus = await reviewResponse.json();
                    if (reviewStatus.has_reviewed) {
                        if (sections.reviewForm) sections.reviewForm.innerHTML = `<div class="text-center p-8 bg-gray-700 rounded-lg"><p class="text-lg text-green-400">Thank you for your review!</p></div>`;
                    } else {
                        if (sections.reviewForm) {
                            sections.reviewForm.innerHTML = `
                                <h3 class="text-2xl font-bold mb-4 text-center">Leave a Review</h3>
                                <form id="reviewForm" class="bg-gray-700 p-8 rounded-lg space-y-4">
                                    <div class="star-rating flex flex-row-reverse justify-center">
                                        <input type="radio" id="star5" name="rating" value="5" required/><label for="star5" title="5 stars">☆</label>
                                        <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4 stars">☆</label>
                                        <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3 stars">☆</label>
                                        <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2 stars">☆</label>
                                        <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="1 star">☆</label>
                                    </div>
                                    <div><textarea name="review_text" placeholder="Share your experience..." rows="4" required class="w-full p-3 bg-gray-600 rounded-md border border-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500"></textarea></div>
                                    <button type="submit" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-6 rounded-md transition-colors">Submit Review</button>
                                    <div id="reviewResponseMessage" class="mt-4 text-center text-lg"></div>
                                </form>`;
                            sections.reviewForm.addEventListener('submit', (e) => { if (e.target.id === 'reviewForm') handleReviewSubmit(e); });
                        }
                    }
                    if (sections.reviewForm) sections.reviewForm.classList.remove('hidden');
                } catch (error) { console.error("Could not check review status:", error); }
                
            } else {
                isUserLoggedIn = false;
                desktopLinksHTML += `
                    <div class="flex space-x-6 items-center">
                        <a href="login.html" class="hover:text-cyan-400 transition-colors">Login</a>
                        <a href="register.html" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-md transition-colors">Register</a>
                    </div>`;
                mobileLinksHTML += `
                    <a href="login.html" class="hover:text-cyan-400 transition-colors">Login</a>
                    <a href="register.html" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-md transition-colors">Register</a>`;
                
                if (heroCtaBtn) { heroCtaBtn.textContent = 'Login to View Services'; heroCtaBtn.href = 'login.html'; }
                if (sections.services) sections.services.classList.add('hidden');
                if (sections.upload) sections.upload.classList.add('hidden');
                if (sections.reviewForm) sections.reviewForm.classList.add('hidden');
            }
            
            if (desktopNav) desktopNav.innerHTML = desktopLinksHTML;
            if (mobileMenu) {
                mobileMenu.innerHTML = mobileLinksHTML.replaceAll('class="', 'class="block py-2 text-lg ');
                mobileMenu.querySelectorAll('a').forEach(link => link.addEventListener('click', toggleMenu));
            }
        };

        try {
            const sessionResponse = await fetch(`check_session.php`);
            const sessionData = await sessionResponse.json();
            await updateUIForSession(sessionData);
            await fetchReviews();
            renderServices(services);
        } catch (error) {
            console.error("Initialization failed:", error);
            await updateUIForSession({ loggedin: false });
            await fetchReviews();
            renderServices(services);
        }
      });
    </script>
</body>
</html>
